<!DOCTYPE html>
<html>
	<head>
		<title>API Connectivity Test for fotods.no</title>
		<style>
			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI',
					Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans',
					'Helvetica Neue', sans-serif;
				max-width: 800px;
				margin: 0 auto;
				padding: 20px;
				background-color: #f5f7fa;
				color: #333;
				line-height: 1.6;
			}
			h1 {
				color: #2c3e50;
				border-bottom: 2px solid #3498db;
				padding-bottom: 10px;
			}
			.test-panel {
				background-color: white;
				border-radius: 8px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
				padding: 20px;
				margin-bottom: 20px;
			}
			.buttons {
				display: flex;
				gap: 10px;
				flex-wrap: wrap;
				margin-bottom: 20px;
			}
			button {
				background-color: #3498db;
				color: white;
				border: none;
				padding: 10px 15px;
				border-radius: 4px;
				cursor: pointer;
				font-size: 14px;
				transition: background-color 0.3s;
			}
			button:hover {
				background-color: #2980b9;
			}
			pre {
				background-color: #f8f9fa;
				border-radius: 4px;
				padding: 15px;
				overflow: auto;
				max-height: 300px;
				border-left: 4px solid #3498db;
			}
			.success {
				color: #27ae60;
				font-weight: bold;
			}
			.error {
				color: #e74c3c;
				font-weight: bold;
			}
			.info {
				margin-top: 20px;
				padding: 15px;
				background-color: #ecf0f1;
				border-radius: 4px;
			}
		</style>
	</head>
	<body>
		<h1>API Connectivity Test for fotods.no</h1>

		<div class="test-panel">
			<h2>Test API Endpoints</h2>
			<div class="buttons">
				<button onclick="testHealth()">Test Health Endpoint</button>
				<button onclick="testImages()">Test Images Endpoint</button>
				<button onclick="testOptions()">Test CORS Preflight</button>
				<button onclick="testFetchWithCredentials()">
					Test with Credentials
				</button>
			</div>

			<h3>Results:</h3>
			<pre id="results">
Results will appear here after clicking a test button...</pre
			>
		</div>

		<div class="info">
			<h3>Connection Info:</h3>
			<p>Testing API at: <strong>http://api.fotods.no</strong></p>
			<p>Origin: <strong id="origin"></strong></p>
			<p>Current time: <strong id="time"></strong></p>
		</div>

		<script>
			const resultsEl = document.getElementById('results');
			document.getElementById('origin').textContent =
				window.location.origin;
			document.getElementById('time').textContent =
				new Date().toLocaleString();

			function log(message, type = 'info') {
				const timestamp = new Date().toLocaleTimeString();
				const className =
					type === 'error'
						? 'error'
						: type === 'success'
						? 'success'
						: '';
				resultsEl.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
			}

			function clearResults() {
				resultsEl.innerHTML = '';
			}

			async function testHealth() {
				clearResults();
				log('Testing health endpoint...');

				try {
					const response = await fetch('http://api.fotods.no/health');
					log(
						`Status: ${response.status} ${response.statusText}`,
						'success',
					);

					const data = await response.text();
					log(`Response: ${data}`, 'success');
				} catch (error) {
					log(`Error: ${error.message}`, 'error');
					log('Check browser console for more details', 'error');
				}
			}

			async function testImages() {
				clearResults();
				log('Testing images endpoint...');

				try {
					const response = await fetch('http://api.fotods.no/images');
					log(
						`Status: ${response.status} ${response.statusText}`,
						'success',
					);

					const data = await response.json();
					log(`Received ${data.length} items`, 'success');
					log(`Data: ${JSON.stringify(data, null, 2)}`, 'success');
				} catch (error) {
					log(`Error: ${error.message}`, 'error');
					log('Check browser console for more details', 'error');
				}
			}

			async function testOptions() {
				clearResults();
				log('Testing OPTIONS preflight request...');

				try {
					const response = await fetch(
						'http://api.fotods.no/images',
						{
							method: 'OPTIONS',
							headers: {
								Origin: 'https://fotods.no',
								'Access-Control-Request-Method': 'GET',
							},
						},
					);

					log(
						`Status: ${response.status} ${response.statusText}`,
						'success',
					);

					// Get all headers
					const headers = {};
					response.headers.forEach((value, key) => {
						headers[key] = value;
						log(`Header: ${key}: ${value}`);
					});

					// Check CORS headers specifically
					if (headers['access-control-allow-origin']) {
						log(
							`CORS Origin: ${headers['access-control-allow-origin']}`,
							'success',
						);
					}
					if (headers['access-control-allow-methods']) {
						log(
							`CORS Methods: ${headers['access-control-allow-methods']}`,
							'success',
						);
					}

					log('Preflight request successful!', 'success');
				} catch (error) {
					log(`Error: ${error.message}`, 'error');
					log('Check browser console for more details', 'error');
				}
			}

			async function testFetchWithCredentials() {
				clearResults();
				log('Testing fetch with credentials...');

				try {
					const response = await fetch(
						'http://api.fotods.no/images',
						{
							method: 'GET',
							credentials: 'include',
							headers: {
								'Content-Type': 'application/json',
							},
						},
					);

					log(
						`Status: ${response.status} ${response.statusText}`,
						'success',
					);

					const data = await response.json();
					log(`Data received successfully!`, 'success');
					log(
						`Response: ${JSON.stringify(data, null, 2)}`,
						'success',
					);
				} catch (error) {
					log(`Error: ${error.message}`, 'error');
					log(
						'This may fail if the API does not support credentials',
						'error',
					);
					log('Check browser console for more details', 'error');
				}
			}
		</script>
	</body>
</html>
